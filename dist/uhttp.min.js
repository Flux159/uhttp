/*! uhttp v1.0.0 | (c) 2015 @flux159 | https://flux159.github.io/uhttp */
!function(a,b){"function"==typeof define&&define.amd?define(b):a.uhttp=b(a)}(this,function(a){"use strict";function b(a,b){this.name=a,this.data={},b||(b={}),this.timeout=b.timeout||0}function c(a){return null!==a&&"object"==typeof a}function d(a){return null!==a&&"string"==typeof a}function e(a){return"[object File]"===x.call(a)}function f(a){return"[object Blob]"===x.call(a)}function g(a){return"[object FormData]"===x.call(a)}function h(a){return a}function i(a){return a}function j(a){return!c(a)||e(a)||f(a)||g(a)?a:JSON.stringify(a)}function k(a){var b,c=a.responseText;try{b=JSON.parse(c)}catch(d){b=c}return b}function l(a){var b=a,c=document.documentMode;return c&&(y.setAttribute("href",b),b=y.href),y.setAttribute("href",b),{href:y.href,protocol:y.protocol?y.protocol.replace(/:$/,""):"",host:y.host,search:y.search?y.search.replace(/^\?/,""):"",hash:y.hash?y.hash.replace(/^#/,""):"",hostname:y.hostname,port:y.port,pathname:"/"===y.pathname.charAt(0)?y.pathname:"/"+y.pathname}}function m(a){var b=d(a)?l(a):a;return b.protocol===z.protocol&&b.host===z.host}function n(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return""}function o(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+"; "+e}function p(a){B=a,B.headers&&c(B.headers)||(B.headers={})}function q(){return B}function r(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function s(a,b){for(var c in b)b.hasOwnProperty(c)&&a.setRequestHeader(c,b[c])}function t(a){var b={then:function(){},"catch":function(){},"finally":function(){}},c={then:function(a){return b.then=a,c},"catch":function(a){return b["catch"]=a,c},"finally":function(a){return b["finally"]=a,a}},d="uhttp_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),e=document.createElement("script");return window[d]=function(a){e.parentNode.removeChild(e),window[d]=void 0,b.then.call(b,a),b["finally"].call(b,a)},e.onerror=function(a){e.parentNode.removeChild(e),window[d]=void 0,b["catch"].call(b,a),b["finally"].call(b,a)},e.src=a.replace("JSON_CALLBACK",d),document.body.appendChild(e),c}function u(b,d,h,i){h||(h={});var j={then:function(){},"catch":function(){},"finally":function(){}},k={then:function(a){return j.then=a,k},"catch":function(a){return j["catch"]=a,k},"finally":function(a){return j["finally"]=a,a}},l={};if(r(l,{Accept:"application/json, text/plain, */*"}),("POST"===b||"PUT"===b||"PATCH"===b)&&(!c(i)||e(i)||f(i)||g(i)||r(l,{"Content-Type":C})),r(l,B.headers),c(h.headers)&&r(l,h.headers),m(d)){var o={},p=n(h.xsrfCookieName||B.xsrfCookieName||A.xsrfCookieName);p&&(o[h.xsrfHeaderName||B.xsrfHeaderName||A.xsrfHeaderName]=p,r(l,o))}var q={timeout:h.timeout||B.timeout,cache:h.cache||B.cache,withCredentials:h.withCredentials||B.withCredentials,progressHandler:h.progressHandler||B.progressHandler,transformRequest:h.transformRequest||B.transformRequest||A.transformRequest,transformResponse:h.transformResponse||B.transformResponse||A.transformResponse,transformRequestData:h.transformRequestData||B.transformRequestData||A.transformRequestData,transformResponseData:h.transformResponseData||B.transformResponseData||A.transformResponseData},t={headers:l,options:q,type:b,url:d};q.transformRequest(t);var u=t.options.cache;if("GET"===t.type&&u){var v;if(v="boolean"==typeof u?w.get("__default").get(d):"Cache"===u.constructor.name?u.get(d):u.cache.get(d))return setTimeout(function(){j.then.call(j,v)},1),k}var x=a.XMLHttpRequest||ActiveXObject,y=new x("MSXML2.XMLHTTP.3.0");return t.options.progressHandler&&y.upload&&(y.upload.onprogress=t.options.progressHandler),y.open(t.type,t.url,!0),s(y,t.headers),t.options.withCredentials&&(y.withCredentials=!0),y.onreadystatechange=function(){if(4===y.readyState){t.options.transformResponse(y);var a=t.options.transformResponseData(y);y.status>=200&&y.status<300||304===y.status?("GET"===b&&u&&("boolean"==typeof u?w.get("__default").set(d,a):"Cache"===u.constructor.name?u.set(d,a):u.cache.set(d,a,u.options)),j.then.call(j,a,y.status,y)):j["catch"].call(j,a,y.status,y),j["finally"].call(j,a,y.status,y)}},y.send(t.options.transformRequestData(i)),t.options.timeout>0&&setTimeout(function(){y&&y.abort()},t.options.timeout),k}b.prototype.remove=function(a){delete this.data[a]},b.prototype.clear=function(){this.data={}},b.prototype.set=function(a,b,c){if(this.data[a]=b,c||(c={}),(c.timeout||this.timeout)>0){var d=this;setTimeout(function(){d.remove(a)},c.timeout||this.timeout)}},b.prototype.get=function(a){return this.data[a]};var v=function(){function a(){var a={__default:new b("__default")};return{get:function(c,d){if(a[c])return a[c];var e=new b(c,d);return a[c]=e,e}}}var c=null;return{getFactory:function(){return c||(c=a()),c}}}(),w=v.getFactory(),x=Object.prototype.toString,y=document.createElement("a"),z=l(window.location.href),A={transformRequest:h,transformResponse:i,transformRequestData:j,transformResponseData:k,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"},B={headers:{},timeout:0,withCredentials:!1},C="application/json;charset=utf-8",D={};return D.setGlobalOptions=p,D.getGlobalOptions=q,D.CacheFactory=w,D.getCookie=n,D.setCookie=o,D.get=function(a,b){return u("GET",a,b)},D.head=function(a,b){return u("HEAD",a,b)},D.put=function(a,b,c){return c||(c=b,b=null),u("PUT",a,b,c)},D.patch=function(a,b,c){return c||(c=b,b=null),u("PATCH",a,b,c)},D.post=function(a,b,c){return c||(c=b,b=null),u("POST",a,b,c)},D["delete"]=function(a,b){return u("DELETE",a,b)},D.jsonp=function(a,b){return t(a,b)},D});